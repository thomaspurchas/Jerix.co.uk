{% extends "q_and_a/base.html" %}
{% load hitcount_tags %}
{% load compress %}

{% block title %}{{ question.title }}{% endblock title %}

{% block head %}
    {{ block.super }}
    {% include "csrf_js.html" %}
{% endblock head %}

{% block header %}
<div class="grid">
    <div class="col-3-4">
        <h1 class="title">{{ question.title }}</h1>
    </div>
    <div class="col-1-4">
    </div>
</div>
{% endblock header %}

{% block content %}
    <div class="col-3-4">
        <div class="module question">
            {% include "q_and_a/post.html" with post=question %}
        </div>
        {% if answers %}
            <div class="module answers">
                <h2>Answers</h2>
                {% for answer in answers %}
                <div class="answer">
                    {% include "q_and_a/post.html" with post=answer %}
                </div>
                {% endfor %}
            </div>
        {% endif %}
        <div class="module your-answer">
        <h3>Your Answer</h3>
            {% include "pagedown.html" %}
        </div>
    </div>
    <div class="col-1-4">
        <div class="module">
            <h3>Related Questions</h3>
        </div>
    </div>

{% endblock content %}

{% block footer %}
    {{ block.super }}
    <script type="text/javascript">
        $(document).ready(function() {
            {% get_hit_count_javascript for question %}
        });
        $(".vote-up,.vote-down").click(function() {
            var rep_box = $(this).parent()
            var rep = $(this)
            var clear = $(this).hasClass('voted')
            if (rep_box.parents('.question').length) {
                var type = 'question'
            } else {
                var type = 'answer'
            }
            if ($(this).hasClass('vote-up')) {
                var choice = 'up'
            } else {
                var choice = 'down'
            }
            var id = rep_box.children('input').attr('value')

            var vote = {
                "type": type,
                "vote": choice,
                "id": id,
                "clear": clear
            };
            $.post(
                '{% url q_and_a.views.vote %}',
                vote,
                function(data) {
                    rep_box.children('.total-votes').html(data['votes']);
                    if (clear) {
                        rep_box.children().removeClass('voted');
                    } else {
                        rep_box.children().removeClass('voted');
                        rep.addClass('voted');
                    }
                }
            );
        });
    </script>
{% endblock footer %}